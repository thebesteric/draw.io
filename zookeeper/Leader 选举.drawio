<mxfile host="app.diagrams.net" modified="2022-02-17T08:59:07.977Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.80 Safari/537.36" etag="tPeJAalRQaXl1U72lJRm" version="16.5.6" type="github">
  <diagram id="eeuKYtuncwknBs3eNNl9" name="Page-1">
    <mxGraphModel dx="2145" dy="813" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="-ZEZr_MwCLdf86qs8En4-5" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="464" y="90" width="340" height="290" as="geometry" />
        </mxCell>
        <mxCell id="-ZEZr_MwCLdf86qs8En4-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;strokeColor=#009900;" parent="1" source="-ZEZr_MwCLdf86qs8En4-1" target="-ZEZr_MwCLdf86qs8En4-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="529" y="180" />
              <mxPoint x="739" y="180" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-ZEZr_MwCLdf86qs8En4-7" value="&lt;b&gt;(1, 0)&lt;/b&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-ZEZr_MwCLdf86qs8En4-3" vertex="1" connectable="0">
          <mxGeometry x="-0.0276" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-2" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.508;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" edge="1" parent="1" source="-ZEZr_MwCLdf86qs8En4-1" target="S4009wVQ3V9HcJUpgxrX-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-ZEZr_MwCLdf86qs8En4-1" value="myid = 1" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="489" y="220" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-ZEZr_MwCLdf86qs8En4-4" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeColor=#FF0000;" parent="1" source="-ZEZr_MwCLdf86qs8En4-2" target="-ZEZr_MwCLdf86qs8En4-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="739" y="340" />
              <mxPoint x="529" y="340" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-ZEZr_MwCLdf86qs8En4-8" value="&lt;b&gt;(2, 0)&lt;/b&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-ZEZr_MwCLdf86qs8En4-4" vertex="1" connectable="0">
          <mxGeometry x="-0.0138" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-6" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;dashed=1;" edge="1" parent="1" source="-ZEZr_MwCLdf86qs8En4-2" target="S4009wVQ3V9HcJUpgxrX-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-ZEZr_MwCLdf86qs8En4-2" value="myid = 2" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="699" y="220" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-ZEZr_MwCLdf86qs8En4-6" value="第一轮选票&lt;br&gt;（2, 0) 选票胜" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="576" y="110" width="116" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-1" value="myid = 1 的机器，投出去(1, 0)，收到的票是 (2, 0)，将收到的票与自己投出去的票进行对比，优先选择 zxid 大的为 leader，zxid 越大表示数据越新，如果 zxid 一样，则优先选择 myid 较大的作为 leader，推荐 (2, 0) 为 leader，但是选票没有过半，所以不能确定 leader" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;size=16;perimeterSpacing=0;spacing=5;spacingTop=5;spacingLeft=5;spacingBottom=5;spacingRight=5;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="160" y="200" width="270" height="120" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-5" value="myid = 2 的机器，投出去(2, 0)，收到的票是 (1, 0)，还是推荐 (2, 0) 做为 leader" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;size=16;perimeterSpacing=0;spacing=5;spacingTop=5;spacingLeft=5;spacingBottom=5;spacingRight=5;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="850" y="195" width="170" height="130" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-7" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="464" y="450" width="340" height="290" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;strokeColor=#009900;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-10" target="S4009wVQ3V9HcJUpgxrX-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="529" y="540" />
              <mxPoint x="739" y="540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-9" value="(2, 0)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontStyle=1" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-8">
          <mxGeometry x="-0.0276" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-16" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-10" target="S4009wVQ3V9HcJUpgxrX-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-10" value="myid = 1" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="489" y="580" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-11" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeColor=#FF0000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-13" target="S4009wVQ3V9HcJUpgxrX-10">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="739" y="700" />
              <mxPoint x="529" y="700" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-12" value="(2, 0)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontStyle=1" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-11">
          <mxGeometry x="-0.0138" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-18" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-13" target="S4009wVQ3V9HcJUpgxrX-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-13" value="myid = 2" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="699" y="580" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-14" value="第二轮选票&lt;br&gt;（2, 0) 选票胜，超过半数节点选 2 号为 leader" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="502" y="470" width="264" height="40" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-15" value="myid = 1 的机器，投出去(2, 0)，收到的票是 (2, 0)，投一台机器的票数已经超过了集群的机器的一半数量，此时选举就结束了，确定 myid = 2 为 leader" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;size=16;perimeterSpacing=0;spacing=5;spacingTop=5;spacingLeft=5;spacingBottom=5;spacingRight=5;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="160" y="560" width="270" height="120" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-17" value="myid = 2 的机器，投出去(2, 0)，收到的票是 (2, 0)，确定 (2, 0) 做为 leader" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;size=16;perimeterSpacing=0;spacing=5;spacingTop=5;spacingLeft=5;spacingBottom=5;spacingRight=5;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="850" y="555" width="170" height="130" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-19" value="&lt;b&gt;&lt;font style=&quot;font-size: 14px&quot; color=&quot;#ff0000&quot;&gt;选票格式：vote = (myid, zxid)&lt;/font&gt;&lt;/b&gt;" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="120" y="70" width="220" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-22" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;fontSize=14;fontColor=#FF0000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-20" target="S4009wVQ3V9HcJUpgxrX-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-20" value="myid = 3" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="594" y="800" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-21" value="myid = 3 的机器，启动时发现已经有 leader 了，此时会让自己变成 follower" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;size=16;perimeterSpacing=0;spacing=5;spacingTop=5;spacingLeft=5;spacingBottom=5;spacingRight=5;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="850" y="800" width="260" height="75" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-27" value="" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-23" target="S4009wVQ3V9HcJUpgxrX-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-28" value="args = /conf/zoo.cfg" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-27">
          <mxGeometry x="-0.3125" y="-1" relative="1" as="geometry">
            <mxPoint x="1" y="9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-23" value="QuorumPeerMain#main" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="100" y="1060" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-32" value="" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-26" target="S4009wVQ3V9HcJUpgxrX-31">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-33" value="解析配置文件加载到内存" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-32">
          <mxGeometry x="-0.0667" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-26" value="initializeAndRun(args);" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="102.5" y="1180" width="175" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-35" value="" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-31" target="S4009wVQ3V9HcJUpgxrX-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-36" value="清理快照文件定时任务" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-35">
          <mxGeometry x="-0.0303" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-31" value="config.parse(args[0]);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="115" y="1300" width="150" height="65" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-38" value="" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-34" target="S4009wVQ3V9HcJUpgxrX-37">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-39" value="核心启动流程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-38">
          <mxGeometry x="-0.04" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-34" value="purgeMgr.start();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="130" y="1430" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;curved=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-37" target="S4009wVQ3V9HcJUpgxrX-40">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="310" y="1580" />
              <mxPoint x="310" y="1090" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-42" value="注册 JMX" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-41">
          <mxGeometry x="0.1203" y="1" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-44" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-37" target="S4009wVQ3V9HcJUpgxrX-43">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="350" y="1580" />
              <mxPoint x="350" y="1190" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-45" value="注册服务端连接对象&lt;br&gt;默认使用 NIO，推荐使用 Netty" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-44">
          <mxGeometry x="0.0778" y="1" relative="1" as="geometry">
            <mxPoint x="1" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-61" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;curved=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" target="S4009wVQ3V9HcJUpgxrX-60">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="265" y="1580" as="sourcePoint" />
            <mxPoint x="550" y="1290" as="targetPoint" />
            <Array as="points">
              <mxPoint x="410" y="1580" />
              <mxPoint x="410" y="1290" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-62" value="获取本服务节点对象" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-61">
          <mxGeometry x="0.6696" y="-27" relative="1" as="geometry">
            <mxPoint x="-35" y="83" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-78" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-37" target="S4009wVQ3V9HcJUpgxrX-77">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-79" value="启动服务节点" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-78">
          <mxGeometry x="0.1538" y="-3" relative="1" as="geometry">
            <mxPoint y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-93" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-37" target="S4009wVQ3V9HcJUpgxrX-67">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-96" value="设置 myid" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-93">
          <mxGeometry x="0.445" y="-9" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-94" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-37" target="S4009wVQ3V9HcJUpgxrX-71">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-97" value="初始化内存数据库" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-94">
          <mxGeometry x="0.4556" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-95" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-37" target="S4009wVQ3V9HcJUpgxrX-74">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-98" value="设置服务节点" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-95">
          <mxGeometry x="0.4577" y="5" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-37" value="runFromConfig(config);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="105" y="1550" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-40" value="ManagedUtil.registerLog4jMBeans();" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="439" y="1060" width="250" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-47" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-43" target="S4009wVQ3V9HcJUpgxrX-46">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-51" value="初始化 Nettry 线程组&lt;br&gt;bossGroup 和 workGroup" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-47">
          <mxGeometry x="-0.2165" relative="1" as="geometry">
            <mxPoint x="20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-43" value="ServerCnxnFactory.createFactory();" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="502" y="1160" width="251" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-53" value="" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-46" target="S4009wVQ3V9HcJUpgxrX-52">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-54" value="绑定业务处理&lt;br&gt;CnxnChannelHandler" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-53">
          <mxGeometry x="-0.0642" y="-1" relative="1" as="geometry">
            <mxPoint x="1" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-46" value="&lt;span style=&quot;text-align: left&quot;&gt;NettyServerCnxnFactory&lt;/span&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1000" y="1160" width="201.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-49" value="如果需要使用 Netty，则需要配置：&amp;nbsp;&lt;br&gt;zookeeper.serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory" style="whiteSpace=wrap;html=1;shape=partialRectangle;top=0;left=0;bottom=1;right=0;points=[[0,1],[1,1]];fillColor=#fff2cc;align=left;verticalAlign=bottom;routingCenterY=0.5;snapToPoint=1;recursiveResize=0;autosize=1;treeFolding=1;treeMoving=1;newEdgeStyle={&quot;edgeStyle&quot;:&quot;entityRelationEdgeStyle&quot;,&quot;startArrow&quot;:&quot;none&quot;,&quot;endArrow&quot;:&quot;none&quot;,&quot;segment&quot;:10,&quot;curved&quot;:1};rounded=0;fontFamily=Helvetica;fontSize=14;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="740" y="1070" width="570" height="40" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-50" value="" style="edgeStyle=entityRelationEdgeStyle;startArrow=none;endArrow=none;segment=10;rounded=0;fontColor=#000000;fontFamily=Helvetica;fontSize=14;strokeColor=#000000;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" target="S4009wVQ3V9HcJUpgxrX-49" parent="1" source="S4009wVQ3V9HcJUpgxrX-43">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="616.25" y="1150" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-56" value="" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;dashed=1;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-52" target="S4009wVQ3V9HcJUpgxrX-55">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-52" value="pipeline.addLast(&quot;servercnxnfactory&quot;, channelHandler);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1410" y="1160" width="387.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-55" value="CnxnChannelHandler#channelRead" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1910" y="1160" width="278.38" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-58" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-57" target="S4009wVQ3V9HcJUpgxrX-55">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-59" value="create /path value" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-58">
          <mxGeometry x="-0.1" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-57" value="Client" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;rounded=0;fontFamily=Helvetica;fontSize=14;strokeColor=#82b366;fillColor=#d5e8d4;" vertex="1" parent="1">
          <mxGeometry x="2009.19" y="960" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-66" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-37" target="S4009wVQ3V9HcJUpgxrX-65">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-69" value="设置选举类型&lt;br&gt;默认为：3" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-66">
          <mxGeometry x="0.1724" relative="1" as="geometry">
            <mxPoint x="32" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-92" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-60" target="S4009wVQ3V9HcJUpgxrX-91">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-60" value="quorumPeer = getQuorumPeer();" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="560" y="1260" width="248" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-65" value="&lt;div&gt;quorumPeer.setElectionType(config.getElectionAlg());&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="720" y="1380" width="358" height="50" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-67" value="&lt;span&gt;quorumPeer.setMyid(config.getServerId());&lt;/span&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="740" y="1470" width="288" height="50" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-71" value="quorumPeer.setZKDatabase(new ZKDatabase(quorumPeer.getTxnFactory()));" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="740" y="1550" width="547" height="50" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-74" value="quorumPeer.setCnxnFactory(cnxnFactory);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="740" y="1640" width="290" height="50" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-81" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-77" target="S4009wVQ3V9HcJUpgxrX-80">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-82" value="加载本地文件到内存" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-81">
          <mxGeometry x="-0.0957" y="2" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-99" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-77" target="S4009wVQ3V9HcJUpgxrX-83">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-100" value="启动 Netty 服务" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-99">
          <mxGeometry x="0.0433" y="-3" relative="1" as="geometry">
            <mxPoint x="15" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-103" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-77" target="S4009wVQ3V9HcJUpgxrX-102">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-104" value="启动 Jetty 管理服务，用来查看服务端状态&lt;br&gt;默认端口：8080" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-103">
          <mxGeometry x="0.3983" y="8" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-109" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-77" target="S4009wVQ3V9HcJUpgxrX-108">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-110" value="初始化集群选举 leader 相关数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-109">
          <mxGeometry x="-0.0064" y="-4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-235" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-77" target="S4009wVQ3V9HcJUpgxrX-234">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-236" value="启动集群选举 leader 线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-235">
          <mxGeometry x="0.2376" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-77" value="quorumPeer.start();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="464" y="1850" width="190" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-80" value="loadDataBase();" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="740" y="1740" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-88" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-83" target="S4009wVQ3V9HcJUpgxrX-87">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-83" value="startServerCnxnFactory();" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="910" y="1810" width="190" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-90" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-87" target="S4009wVQ3V9HcJUpgxrX-89">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-101" value="绑定启动端口" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-90">
          <mxGeometry x="-0.3356" y="-2" relative="1" as="geometry">
            <mxPoint x="17" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-87" value="NettyServerCnxnFactory#start" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1180" y="1810" width="245" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-89" value="bootstrap.bind(localAddress)" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1570" y="1810" width="222.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-107" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-91" target="S4009wVQ3V9HcJUpgxrX-102">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1520" y="1290" />
              <mxPoint x="1520" y="1930" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-91" value="adminServer = AdminServerFactory.createAdminServer();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1000" y="1260" width="410" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-102" value="adminServer.start();" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1180" y="1900" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-106" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-46" target="S4009wVQ3V9HcJUpgxrX-74">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-112" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-108" target="S4009wVQ3V9HcJUpgxrX-111">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-113" value="创建选票" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-112">
          <mxGeometry x="0.0155" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-115" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-108" target="S4009wVQ3V9HcJUpgxrX-114">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-108" value="startLeaderElection();" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="793" y="2050" width="184" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-111" value="currentVote = new Vote(myid, getLastLoggedZxid(), getCurrentEpoch());" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="1110" y="1990" width="498" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-118" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-114" target="S4009wVQ3V9HcJUpgxrX-117">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-119" value="初始化选举管理器" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-118">
          <mxGeometry x="-0.1434" y="-2" relative="1" as="geometry">
            <mxPoint x="1" y="-17" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-121" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-114" target="S4009wVQ3V9HcJUpgxrX-120">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-122" value="启动选举监听" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-121">
          <mxGeometry x="0.2583" y="11" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-171" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-114" target="S4009wVQ3V9HcJUpgxrX-169">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-172" value="启动快速选举算法相关线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-171">
          <mxGeometry x="-0.0552" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-114" value="createElectionAlgorithm(electionType);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1110" y="2100" width="358" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-117" value="createCnxnManager();" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1700" y="2030" width="223" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-124" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-120" target="S4009wVQ3V9HcJUpgxrX-123">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-125" value="调用 run 方法" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-124">
          <mxGeometry x="-0.2176" y="-4" relative="1" as="geometry">
            <mxPoint x="16" y="-4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-120" value="listener.start();" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1700" y="2140" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-127" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-123" target="S4009wVQ3V9HcJUpgxrX-126">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-128" value="在选举端口建立连接&lt;br&gt;使用 BIO 方式" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-127">
          <mxGeometry x="0.3124" y="18" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-130" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-123" target="S4009wVQ3V9HcJUpgxrX-129">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-131" value="接受连接" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-130">
          <mxGeometry x="-0.0303" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-123" value="QuorumCnxManager.Listener#run" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2009.19" y="2140" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-126" value="ss = new ServerSocket();&lt;br&gt;&lt;div&gt;ss.bind(addr);&lt;/div&gt;&lt;div&gt;ss.accept();&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2300" y="1890" width="230" height="70" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-133" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-129" target="S4009wVQ3V9HcJUpgxrX-132">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-134" value="处理连接数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-133">
          <mxGeometry x="-0.0867" y="1" relative="1" as="geometry">
            <mxPoint x="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-129" value="receiveConnection(client);" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="2510" y="2140" width="230.81" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-136" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-132" target="S4009wVQ3V9HcJUpgxrX-135">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-137" value="读取发送选票的机器 id" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-136">
          <mxGeometry x="0.1557" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-139" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-132" target="S4009wVQ3V9HcJUpgxrX-138">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-132" value="handleConnection(sock, din);" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="2890" y="2140" width="213.78" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-135" value="din.readLong();" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="3159.9999999999995" y="1920" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-141" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-138" target="S4009wVQ3V9HcJUpgxrX-140">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-142" value="if (sid &amp;lt; self.getId())" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-141">
          <mxGeometry x="0.2352" y="24" relative="1" as="geometry">
            <mxPoint x="34" y="5" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-144" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-138" target="S4009wVQ3V9HcJUpgxrX-143">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-145" value="if (sid == self.getId())" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-144">
          <mxGeometry x="0.0253" y="24" relative="1" as="geometry">
            <mxPoint x="29" y="-26" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-147" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-138" target="S4009wVQ3V9HcJUpgxrX-146">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-148" value="sid &amp;gt; self.getId()" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-147">
          <mxGeometry x="0.0799" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-138" value="判断" style="rhombus;whiteSpace=wrap;html=1;fontSize=14;rounded=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="3250.6699999999996" y="2130" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-140" value="&lt;div&gt;closeSocket(sock);&lt;/div&gt;&lt;div&gt;如果获取的 sid 小于当前当前机器的 sid，则关闭连接，为了防止机器之间相互重复建立 socket 连接，zk 不允许 id 小的机器连接 id 大的机器&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;connectOne(sid);&lt;/div&gt;&lt;div&gt;让机器主动发起 socket 连接到发送选票的 id 较小的机器上&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;align=left;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="3450" y="1750" width="280" height="170" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-143" value="一般不可能发生，可能是配置文件写错了" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="3520" y="1980" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-150" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-146" target="S4009wVQ3V9HcJUpgxrX-149">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-154" value="在接收到选票的时候 ，就发送给发选票机器建立一个&lt;br&gt;选票发送器线程，供将来发送选票使用，并启动线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-150">
          <mxGeometry x="-0.3006" y="1" relative="1" as="geometry">
            <mxPoint x="-1" y="11" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-152" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-146" target="S4009wVQ3V9HcJUpgxrX-151">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-153" value="rw.start()" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-152">
          <mxGeometry x="-0.0718" y="2" relative="1" as="geometry">
            <mxPoint x="1" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-146" value="&lt;div&gt;SendWorker sw = new SendWorker(sock, sid);&lt;/div&gt;&lt;div&gt;RecvWorker rw = new RecvWorker(sock, din, sid, sw);&lt;/div&gt;&lt;div&gt;sw.setRecv(rw);&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;align=left;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="3610" y="2130" width="350" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-161" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-149" target="S4009wVQ3V9HcJUpgxrX-160">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-162" value="sw.start()" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-161">
          <mxGeometry x="-0.1269" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-149" value="&lt;div&gt;// 给发送选票的 sid 这台机器创建一个选票发送器&lt;/div&gt;&lt;div&gt;SendWorker sw = new SendWorker(sock, sid);&lt;/div&gt;&lt;div&gt;// 将选票发送器与 sid 对应放入 map&lt;/div&gt;&lt;div&gt;senderWorkerMap.put(sid, sw);&lt;br&gt;&lt;/div&gt;&lt;div&gt;// 给发送选票的 sid 机器，初始化一个发送选票队列放入 map&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;queueSendMap.putIfAbsent(sid,new ArrayBlockingQueue&amp;lt;ByteBuffer&amp;gt;(1));&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;// 启动选票发送器线程&lt;/div&gt;&lt;div&gt;sw.start();&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;align=left;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="3536.25" y="2330" width="497.5" height="160" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-156" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-151" target="S4009wVQ3V9HcJUpgxrX-155">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-151" value="RecvWorker#run" style="whiteSpace=wrap;html=1;fontSize=14;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="4110" y="2140" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-158" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-155" target="S4009wVQ3V9HcJUpgxrX-157">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-159" value="最终将选票加入 recvQueue 中，等待异步处理" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=default;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-158">
          <mxGeometry x="-0.025" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-155" value="addToRecvQueue(new Message(message.duplicate(), sid));" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="4310" y="2140" width="410" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-216" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;strokeColor=#000000;dashed=1;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-157" target="S4009wVQ3V9HcJUpgxrX-214">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4830" y="2320" />
              <mxPoint x="4830" y="2470" />
              <mxPoint x="2846" y="2470" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-157" value="recvQueue.add(msg);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#e1d5e7;strokeColor=#9673a6;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="4427.5" y="2290" width="175" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-164" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-160" target="S4009wVQ3V9HcJUpgxrX-163">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-167" value="while" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-164">
          <mxGeometry x="-0.2" y="4" relative="1" as="geometry">
            <mxPoint x="8" y="4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-160" value="SendWorker#run" style="whiteSpace=wrap;html=1;fontSize=14;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="4150" y="2380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-166" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=default;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-163" target="S4009wVQ3V9HcJUpgxrX-165">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-168" value="发送选票" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-166">
          <mxGeometry x="-0.3143" y="-3" relative="1" as="geometry">
            <mxPoint x="12" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-163" value="&lt;font color=&quot;#ff0000&quot;&gt;queueSendMap.get(sid);&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="4350" y="2380" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-213" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;strokeColor=#000000;dashed=1;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-165" target="S4009wVQ3V9HcJUpgxrX-204">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-165" value="send(b);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#e1d5e7;strokeColor=#9673a6;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="4670" y="2380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-174" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-169" target="S4009wVQ3V9HcJUpgxrX-173">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-175" value="fle.start();" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-174">
          <mxGeometry x="-0.1378" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-177" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;dashed=1;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-169" target="S4009wVQ3V9HcJUpgxrX-176">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-191" value="&lt;span style=&quot;color: rgb(0 , 0 , 0) ; background-color: rgb(248 , 249 , 250)&quot;&gt;new FastLeaderElection(this, qcm)&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#FF0000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-177">
          <mxGeometry x="-0.1528" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-169" value="FastLeaderElection fle = new FastLeaderElection(this, qcm);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1580" y="2278" width="410" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-179" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-173" target="S4009wVQ3V9HcJUpgxrX-178">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-182" value="运行发送选票线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-179">
          <mxGeometry x="-0.0446" y="1" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-181" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-173" target="S4009wVQ3V9HcJUpgxrX-180">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-183" value="运行接收选票线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-181">
          <mxGeometry x="-0.0412" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-173" value="messenger.start();" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2130" y="2278" width="130" height="62" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-189" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-176" target="S4009wVQ3V9HcJUpgxrX-188">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-190" value="&lt;span style=&quot;text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;this.messenger = new Messenger(manager);&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-189">
          <mxGeometry x="-0.0714" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-176" value="&lt;div&gt;sendqueue = new LinkedBlockingQueue&amp;lt;ToSend&amp;gt;();&lt;/div&gt;&lt;div&gt;recvqueue = new LinkedBlockingQueue&amp;lt;Notification&amp;gt;();&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#f5f5f5;strokeColor=#666666;rounded=0;align=left;spacing=6;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1597.5" y="2410" width="375" height="70" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-185" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-178" target="S4009wVQ3V9HcJUpgxrX-184">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-178" value="this.wsThread.start();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2450" y="2279" width="165" height="61" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-187" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-180" target="S4009wVQ3V9HcJUpgxrX-186">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-180" value="this.wrThread.start();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2450" y="2384" width="165" height="64" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-193" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-184" target="S4009wVQ3V9HcJUpgxrX-192">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-194" value="获取选票" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-193">
          <mxGeometry x="-0.2015" relative="1" as="geometry">
            <mxPoint x="9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-184" value="WorkerSender#run" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2670" y="2279.5" width="172.5" height="60.5" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-215" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-186" target="S4009wVQ3V9HcJUpgxrX-214">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-186" value="WorkerReceiver#run" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2670" y="2383" width="170" height="66" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-188" value="&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;this.ws = new WorkerSender(manager);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;this.wsThread = new Thread(this.ws,&quot;WorkerSender[myid=&quot; + self.getId() + &quot;]&quot;);&lt;/div&gt;&lt;div&gt;this.wsThread.setDaemon(true);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;this.wr = new WorkerReceiver(manager);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;this.wrThread = new Thread(this.wr,&quot;WorkerReceiver[myid=&quot; + self.getId() + &quot;]&quot;);&lt;/div&gt;&lt;div&gt;this.wrThread.setDaemon(true);&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;align=left;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1572.5" y="2540" width="425" height="162" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-196" value="处理选票" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-192" target="S4009wVQ3V9HcJUpgxrX-195">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-262" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-192" target="S4009wVQ3V9HcJUpgxrX-230">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-264" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-192" target="S4009wVQ3V9HcJUpgxrX-258">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-192" value="ToSend m = sendqueue.poll(3000, TimeUnit.MILLISECONDS);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2948.75" y="2279.75" width="421.25" height="60.25" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-198" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-195" target="S4009wVQ3V9HcJUpgxrX-197">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-195" value="process(m);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="3099.375" y="2420.125" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-200" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-197" target="S4009wVQ3V9HcJUpgxrX-199">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-197" value="manager.toSend(m.sid, requestBuffer);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="3024.06" y="2560" width="270.63" height="59.88" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-202" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-199" target="S4009wVQ3V9HcJUpgxrX-201">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-203" value="if (this.mySid == sid)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-202">
          <mxGeometry x="-0.017" y="-4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-205" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-199" target="S4009wVQ3V9HcJUpgxrX-204">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-206" value="if (this.mySid != sid)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-205">
          <mxGeometry x="-0.0685" y="-7" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-199" value="判断" style="rhombus;whiteSpace=wrap;html=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="3369.995" y="2549.94" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-217" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;dashed=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-201" target="S4009wVQ3V9HcJUpgxrX-214">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3830" y="2540" />
              <mxPoint x="3830" y="2490" />
              <mxPoint x="3302" y="2490" />
              <mxPoint x="3302" y="2530" />
              <mxPoint x="2846" y="2530" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-201" value="如果选票就是自己，则放入自己的接收队列&lt;br&gt;recvQueue.add(msg);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;align=left;" vertex="1" parent="1">
          <mxGeometry x="3620" y="2510" width="190.01" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-208" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-204" target="S4009wVQ3V9HcJUpgxrX-207">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-212" value="放入传输层待发送队列" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-208">
          <mxGeometry x="-0.0833" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-204" value="ArrayBlockingQueue&amp;lt;ByteBuffer&amp;gt; bq = new ArrayBlockingQueue&amp;lt;&amp;gt;(1);&lt;br&gt;&lt;font color=&quot;#ff0000&quot;&gt;queueSendMap.putIfAbsent(sid, bq);&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=0;align=left;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="3620" y="2629.94" width="470.01" height="70.06" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-210" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-207" target="S4009wVQ3V9HcJUpgxrX-209">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-211" value="与对方 sid 机器建立连接" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-210">
          <mxGeometry x="-0.0055" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-207" value="addToSendQueue(bq, b);" style="whiteSpace=wrap;html=1;fontSize=14;align=center;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="3767.51" y="2760" width="174.99" height="54.97" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-209" value="&lt;div style=&quot;text-align: left&quot;&gt;connectOne(sid);&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="3795.005" y="2892.455" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-219" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-214" target="S4009wVQ3V9HcJUpgxrX-218">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-220" value="if(self.getPeerState() == QuorumPeer.ServerState.LOOKING)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;fontStyle=0" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-219">
          <mxGeometry x="0.0437" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-214" value="Message response = manager.pollRecvQueue(3000, TimeUnit.MILLISECONDS);" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2430" y="2561.88" width="555" height="58" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-222" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-218" target="S4009wVQ3V9HcJUpgxrX-221">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-223" value="是&lt;br&gt;主机还处于选举状态" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-222">
          <mxGeometry x="0.4312" y="22" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-228" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-218" target="S4009wVQ3V9HcJUpgxrX-227">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-229" value="否&lt;br&gt;本机不是选举状态，已经选出了 leader" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-228">
          <mxGeometry x="-0.0787" y="-20" relative="1" as="geometry">
            <mxPoint x="9" y="11" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-218" value="判断" style="rhombus;whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2667.5" y="2688.88" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-225" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-221" target="S4009wVQ3V9HcJUpgxrX-224">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-226" value="&lt;div&gt;if((ackstate == QuorumPeer.ServerState.LOOKING)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;&amp;amp; (n.electionEpoch &amp;lt; logicalclock.get()))&lt;/div&gt;&lt;div&gt;如果发送选票方是选举状态并且发送选举周期小于自己，&lt;/div&gt;&lt;div&gt;则&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-225">
          <mxGeometry x="-0.0472" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-268" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;dashed=1;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-221" target="S4009wVQ3V9HcJUpgxrX-265">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-221" value="recvqueue.offer(n);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2481" y="2820" width="139" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-224" value="sendqueue.offer(notmsg);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2460.75" y="2990" width="179.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-231" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-227" target="S4009wVQ3V9HcJUpgxrX-230">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-232" value="if(ackstate == QuorumPeer.ServerState.LOOKING)&lt;br&gt;如果发送选票方是选举状态，则把本机认为的 leader 选票发送给发送方" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-231">
          <mxGeometry x="-0.0347" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-227" value="Vote current = self.getCurrentVote();&lt;br&gt;获取本机当前选票，这个选票一般是 leader" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2842.5" y="2820" width="287.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-230" value="sendqueue.offer(notmsg);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2894.38" y="2990" width="183.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-238" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-234" target="S4009wVQ3V9HcJUpgxrX-237">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-234" value="super.start();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="766" y="2330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-240" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-237" target="S4009wVQ3V9HcJUpgxrX-239">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-241" value="while(running)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-240">
          <mxGeometry x="-0.0881" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-237" value="QuorumPeer#run" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="966" y="2330" width="154" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-243" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-239" target="S4009wVQ3V9HcJUpgxrX-242">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-239" value="switch (getPeerState())&lt;br&gt;节点自己的状态" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="943" y="2480.13" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-245" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-242" target="S4009wVQ3V9HcJUpgxrX-246">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1227" y="2670" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-250" value="&lt;span style=&quot;background-color: rgb(248 , 249 , 250)&quot;&gt;case LOOKING&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#FF0000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-245">
          <mxGeometry x="-0.0892" y="-4" relative="1" as="geometry">
            <mxPoint x="-36" y="37" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-355" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-242" target="S4009wVQ3V9HcJUpgxrX-354">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-356" value="case FOLLOWING" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#FF0000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-355">
          <mxGeometry x="-0.25" y="-12" relative="1" as="geometry">
            <mxPoint x="99" y="-18" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-388" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-242" target="S4009wVQ3V9HcJUpgxrX-387">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-389" value="case LEADING" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#FF0000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-388">
          <mxGeometry x="0.0419" y="31" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-242" value="判断" style="rhombus;whiteSpace=wrap;html=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1003" y="2581" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-249" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-246" target="S4009wVQ3V9HcJUpgxrX-248">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-251" value="选举周期加 1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-249">
          <mxGeometry x="0.0139" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-253" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-246" target="S4009wVQ3V9HcJUpgxrX-252">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-254" value="初始化选票（自己）" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-253">
          <mxGeometry x="0.0479" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-256" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-246" target="S4009wVQ3V9HcJUpgxrX-255">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-257" value="发送选票选自己" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-256">
          <mxGeometry x="0.1545" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-266" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-246" target="S4009wVQ3V9HcJUpgxrX-265">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-267" value="&lt;div&gt;while ((self.getPeerState() == ServerState.LOOKING) &amp;amp;&amp;amp; (!stop))&lt;/div&gt;&lt;div&gt;当前节点是选举状态会不断的从应用层接收队列里拿选票做选举&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-266">
          <mxGeometry x="0.2483" y="2" relative="1" as="geometry">
            <mxPoint x="4" y="9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-246" value="makeLEStrategy().lookForLeader()" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1110" y="2800" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-248" value="logicalclock.incrementAndGet();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1488" y="2740" width="250" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-252" value="updateProposal(getInitId(), getInitLastLoggedZxid(), getPeerEpoch());" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1631" y="2835.45" width="292" height="57" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-259" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-255" target="S4009wVQ3V9HcJUpgxrX-258">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-255" value="sendNotifications();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1608" y="2970" width="142" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-258" value="sendqueue.offer(notmsg);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1841" y="2970" width="189" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-271" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-265" target="S4009wVQ3V9HcJUpgxrX-270">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-265" value="Notification n = recvqueue.poll(notTimeout, TimeUnit.MILLISECONDS);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1488" y="3110" width="312" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-273" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-270" target="S4009wVQ3V9HcJUpgxrX-272">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-274" value="是" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-273">
          <mxGeometry x="-0.31" y="3" relative="1" as="geometry">
            <mxPoint x="-9" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-280" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-270" target="S4009wVQ3V9HcJUpgxrX-279">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-281" value="否&amp;nbsp;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-280">
          <mxGeometry x="-0.0595" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-270" value="n == null" style="rhombus;whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1604" y="3240" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-276" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-272" target="S4009wVQ3V9HcJUpgxrX-275">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-272" value="manager.connectAll();&lt;br&gt;&lt;br&gt;第一次启动时肯定是没有选票的，这是会跟发送选票的机器建立连接" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1277" y="3235" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-275" value="connectOne(sid);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1323" y="3370" width="138" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-288" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-279" target="S4009wVQ3V9HcJUpgxrX-287">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-290" value="case LOOKING&lt;br&gt;主线逻辑" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#FF0000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-288">
          <mxGeometry x="-0.1406" y="-1" relative="1" as="geometry">
            <mxPoint x="1" y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-336" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-279" target="S4009wVQ3V9HcJUpgxrX-338">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2570" y="4780" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-337" value="&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;case FOLLOWING:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;case LEADING:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;这种状态一般是已经选出 leader 的集群&lt;/div&gt;&lt;div&gt;有新的机器加入了，新的机器处于 looking 状态&lt;/div&gt;&lt;div&gt;会先投票给自己，其他机器收到后会回发已经选出&lt;/div&gt;&lt;div&gt;的 leader 的选票，这个选票发送方的状态就是 follower 或 leader&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-336">
          <mxGeometry x="-0.0265" relative="1" as="geometry">
            <mxPoint x="-321" y="-321" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-279" value="switch&lt;br&gt;n.state" style="rhombus;whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1810" y="3240" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-282" value="判断发送方的选票状态" style="whiteSpace=wrap;html=1;shape=partialRectangle;top=0;left=0;bottom=1;right=0;points=[[0,1],[1,1]];fillColor=none;align=center;verticalAlign=bottom;routingCenterY=0.5;snapToPoint=1;recursiveResize=0;autosize=1;treeFolding=1;treeMoving=1;newEdgeStyle={&quot;edgeStyle&quot;:&quot;entityRelationEdgeStyle&quot;,&quot;startArrow&quot;:&quot;none&quot;,&quot;endArrow&quot;:&quot;none&quot;,&quot;segment&quot;:10,&quot;curved&quot;:1};fontColor=#000000;rounded=0;fontFamily=Helvetica;fontSize=14;strokeColor=default;" vertex="1" parent="1">
          <mxGeometry x="1890" y="3190" width="170" height="20" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-283" value="" style="edgeStyle=entityRelationEdgeStyle;startArrow=none;endArrow=none;segment=10;curved=1;rounded=0;fontColor=#000000;fontFamily=Helvetica;fontSize=14;strokeColor=#000000;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;" edge="1" target="S4009wVQ3V9HcJUpgxrX-282" parent="1" source="S4009wVQ3V9HcJUpgxrX-279">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1910" y="3230" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-292" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-287" target="S4009wVQ3V9HcJUpgxrX-291">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-293" value="if (n.electionEpoch &amp;gt; logicalclock.get())&lt;br&gt;&lt;br&gt;接收的选票选举周期大于自己的选举周期，&lt;br&gt;这种情况可能是自己后启动加入集群的，或者&lt;br&gt;网络中断后重新加入集群，其他机器已经选过&lt;br&gt;好几轮了，所以需要更新自己的选票周期到最新" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-292">
          <mxGeometry x="-0.0632" y="26" relative="1" as="geometry">
            <mxPoint x="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-342" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-287" target="S4009wVQ3V9HcJUpgxrX-341">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-343" value="if (n.electionEpoch &amp;lt; logicalclock.get())&lt;br&gt;&lt;br&gt;接收到的选票的选举周期小于自己，意味着&lt;br&gt;发选票的机器也是才加入集群，投的是自己&lt;br&gt;这样的选票直接废弃掉" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-342">
          <mxGeometry x="-0.2765" y="1" relative="1" as="geometry">
            <mxPoint x="19" y="17" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-346" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-287" target="S4009wVQ3V9HcJUpgxrX-345">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-347" value="if (n.electionEpoch == logicalclock.get())&lt;br&gt;&lt;br&gt;接收到的选票周期等于自己，意味着大家&lt;br&gt;一直在参与选举，那么在需要和自己的选票&lt;br&gt;进行 PK" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-346">
          <mxGeometry x="0.5183" y="-26" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-287" value="判断" style="rhombus;whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1830" y="3420" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-295" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-291" target="S4009wVQ3V9HcJUpgxrX-294">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-296" value="选票 PK&lt;br&gt;由于自己的选举周期落后的，可能就是刚加入集群选举&lt;br&gt;所以是拿收到收到的选票和投给自己的选票做比较" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-295">
          <mxGeometry x="-0.3655" y="-2" relative="1" as="geometry">
            <mxPoint x="2" y="9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-291" value="&lt;div&gt;// 更新自己的选票周期&lt;/div&gt;&lt;div&gt;logicalclock.set(n.electionEpoch);&lt;/div&gt;&lt;div&gt;// 清空投票箱&lt;/div&gt;&lt;div&gt;recvset.clear();&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;align=left;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1468" y="3590" width="242" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-298" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-294" target="S4009wVQ3V9HcJUpgxrX-297">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-299" value="具体的 PK 逻辑" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-298">
          <mxGeometry x="-0.004" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-294" value="totalOrderPredicate(n.leader, n.zxid, n.peerEpoch, getInitId(), getInitLastLoggedZxid(), getPeerEpoch())" style="whiteSpace=wrap;html=1;fontSize=14;align=left;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1418.5" y="3770" width="341" height="70" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-301" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-297" target="S4009wVQ3V9HcJUpgxrX-300">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-302" value="true&lt;br&gt;收到的选票胜" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-301">
          <mxGeometry x="0.0106" y="-1" relative="1" as="geometry">
            <mxPoint x="28" y="26" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-304" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-297" target="S4009wVQ3V9HcJUpgxrX-303">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-305" value="false&lt;br&gt;自己胜" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-304">
          <mxGeometry x="0.2315" y="-21" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-297" value="&lt;div&gt;((newEpoch &amp;gt; curEpoch) ||&lt;/div&gt;&lt;div&gt;&amp;nbsp;((newEpoch == curEpoch) &amp;amp;&amp;amp;&lt;span&gt;&amp;nbsp;((newZxid &amp;gt; curZxid) ||&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;((newZxid == curZxid) &amp;amp;&amp;amp; (newId &amp;gt; curId)))));&lt;/span&gt;&lt;/div&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=14;align=center;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1313.25" y="3890" width="551.5" height="110" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-307" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-300" target="S4009wVQ3V9HcJUpgxrX-306">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-300" value="updateProposal(n.leader, n.zxid, n.peerEpoch);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1020" y="4063" width="330" height="58" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-308" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-303" target="S4009wVQ3V9HcJUpgxrX-306">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-303" value="updateProposal(getInitId(), getInitLastLoggedZxid(), getPeerEpoch());" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1738" y="4063" width="465" height="69" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-310" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-306" target="S4009wVQ3V9HcJUpgxrX-309">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-311" value="给其他的机器发送选票" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-310">
          <mxGeometry x="-0.147" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-313" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-306" target="S4009wVQ3V9HcJUpgxrX-312">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-314" value="将接收到的选票放入选票箱" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-313">
          <mxGeometry x="0.0305" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-306" value="sendNotifications();&lt;br&gt;发送选票" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1500" y="4320" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-309" value="sendqueue.offer(notmsg);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1923" y="4320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-316" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-312" target="S4009wVQ3V9HcJUpgxrX-315">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-317" value="过半选举逻辑" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-316">
          <mxGeometry x="-0.1962" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-312" value="recvset.put(n.sid, new Vote(n.leader, n.zxid, n.electionEpoch, n.peerEpoch));" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1399" y="4470" width="380" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-319" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-315" target="S4009wVQ3V9HcJUpgxrX-318">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-320" value="for (Map.Entry&amp;lt;Long, Vote&amp;gt; entry : votes.entrySet())&lt;br&gt;与本机投的 leader 选票对比，如果相等，将投票机器&lt;br&gt;的 sid 加入 voteSet" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-319">
          <mxGeometry x="-0.0899" y="-1" relative="1" as="geometry">
            <mxPoint x="6" y="-43" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-327" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-315" target="S4009wVQ3V9HcJUpgxrX-326">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-328" value="在上一步选出 leader 之后，再看看是否还有新选票加入&lt;br&gt;如果有，还需要做选票的 PK，如果新选票获胜则从新选举" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-327">
          <mxGeometry x="-0.0827" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-330" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-315" target="S4009wVQ3V9HcJUpgxrX-329">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-331" value="如果本机投的 leader 和 本机的 sid 一致&lt;br&gt;则自己就是 leader，否则就是 follow 或 observer" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-330">
          <mxGeometry x="-0.0935" y="4" relative="1" as="geometry">
            <mxPoint x="151" y="9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-315" value="termPredicate(recvset, new Vote(proposedLeader, proposedZxid, logicalclock.get(), proposedEpoch))" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1384.5" y="4610" width="411" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-322" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-318" target="S4009wVQ3V9HcJUpgxrX-321">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-318" value="if (vote.equals(entry.getValue()))&lt;br&gt;voteSet.addAck(entry.getKey());" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;spacing=6;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="2135" y="4430" width="245" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-324" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-321" target="S4009wVQ3V9HcJUpgxrX-323">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-325" value="投票机器超过半数" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-324">
          <mxGeometry x="-0.3873" y="-3" relative="1" as="geometry">
            <mxPoint x="3" y="9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-321" value="voteSet.hasAllQuorums();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="2161.25" y="4560" width="192.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-323" value="ackSet.size() &amp;gt; half" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="2151.25" y="4690" width="212.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-326" value="&lt;div&gt;while((n = recvqueue.poll(finalizeWait, TimeUnit.MILLISECONDS)) != null) {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;if(totalOrderPredicate(n.leader, n.zxid, n.peerEpoch, proposedLeader, proposedZxid, proposedEpoch)) {&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;recvqueue.put(n);&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;break;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;spacing=6;align=left;" vertex="1" parent="1">
          <mxGeometry x="1003" y="4860" width="710" height="130" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-333" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-329" target="S4009wVQ3V9HcJUpgxrX-332">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-334" value="返回选出的 leader 并设置到自己节点的&lt;br&gt;currentVote 属性中" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-333">
          <mxGeometry x="-0.1137" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-339" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=#000000;dashed=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-329" target="S4009wVQ3V9HcJUpgxrX-338">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-340" value="类似逻辑" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-339">
          <mxGeometry x="-0.1216" y="1" relative="1" as="geometry">
            <mxPoint x="17" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-329" value="&lt;div&gt;self.setPeerState((proposedLeader == self.getId()) ?&lt;/div&gt;&lt;div&gt;ServerState.LEADING: learningState());&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1830" y="4860" width="350" height="70" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-332" value="return endVote" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="1945" y="5015" width="118" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-338" value="&lt;div&gt;self.setPeerState((n.leader == self.getId()) ?&lt;/div&gt;&lt;div&gt;ServerState.LEADING: learningState());&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;strokeColor=default;fillColor=default;" vertex="1" parent="1">
          <mxGeometry x="2370.5" y="4860" width="360" height="70" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-341" value="berak;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1852.5" y="3660" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-348" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-345" target="S4009wVQ3V9HcJUpgxrX-297">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2040" y="3870" />
              <mxPoint x="1589" y="3870" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-349" value="具体的 PK 逻辑" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-348">
          <mxGeometry x="-0.1368" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-351" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-345" target="S4009wVQ3V9HcJUpgxrX-350">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-352" value="true&lt;br&gt;收到的选票获胜" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-351">
          <mxGeometry x="-0.1099" y="6" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-345" value="&lt;div&gt;totalOrderPredicate(n.leader, n.zxid, n.peerEpoch,&lt;/div&gt;&lt;div&gt;proposedLeader, proposedZxid, proposedEpoch)&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2040" y="3770" width="340" height="70" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-353" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-350" target="S4009wVQ3V9HcJUpgxrX-306">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2258" y="4250" />
              <mxPoint x="1590" y="4250" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-350" value="updateProposal(n.leader, n.zxid, n.peerEpoch);" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2097.5" y="3935" width="320" height="65" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-358" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;startArrow=none;startFill=0;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-354" target="S4009wVQ3V9HcJUpgxrX-357">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="787" y="2830" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-360" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;startArrow=none;startFill=0;strokeColor=#000000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-354" target="S4009wVQ3V9HcJUpgxrX-359">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-361" value="与 leader 建立连接，并接受 leader 数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-360">
          <mxGeometry x="-0.0829" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-354" value="makeFollower(logFactory)" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="581" y="2800" width="184" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-357" value="new Follower(this, new &lt;font color=&quot;#ff0000&quot;&gt;FollowerZooKeeperServer&lt;/font&gt;(logFactory, this, this.zkDb));" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="820" y="2800" width="258" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-363" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-359" target="S4009wVQ3V9HcJUpgxrX-362">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-364" value="获取 leader Server" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-363">
          <mxGeometry x="0.1244" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-378" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-359" target="S4009wVQ3V9HcJUpgxrX-377">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-385" value="如果 leader 挂了，会触发 finally" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-378">
          <mxGeometry x="-0.15" y="3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-359" value="follower.followLeader();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="865.5" y="2970" width="167" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-366" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-362" target="S4009wVQ3V9HcJUpgxrX-365">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-367" value="主动向 leader 发起 socket 请求" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-366">
          <mxGeometry x="-0.04" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-362" value="QuorumServer leaderServer = findLeader();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="512" y="3050" width="292" height="50" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-369" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-365" target="S4009wVQ3V9HcJUpgxrX-368">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-370" value="注册自己到 leader" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-369">
          <mxGeometry x="-0.075" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-426" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-365" target="S4009wVQ3V9HcJUpgxrX-425">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-365" value="connectToLeader(leaderServer.addr, leaderServer.hostname);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="512" y="3175" width="292" height="65" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-372" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-368" target="S4009wVQ3V9HcJUpgxrX-371">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-373" value="同步 leader 数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-372">
          <mxGeometry x="-0.0222" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-368" value="registerWithLeader(Leader.FOLLOWERINFO);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="497" y="3320" width="322" height="57.5" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-375" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-371" target="S4009wVQ3V9HcJUpgxrX-374">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-376" value="while (self.isRunning())&lt;br&gt;循环接受 leader 发送到数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-375">
          <mxGeometry x="-0.0229" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-371" value="syncWithLeader(newEpochZxid);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="542" y="3456.25" width="232" height="63.75" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-382" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-374" target="S4009wVQ3V9HcJUpgxrX-381">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-374" value="&lt;div&gt;QuorumPacket qp = new QuorumPacket();&lt;/div&gt;&lt;div&gt;while (self.isRunning()) {&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;readPacket(qp);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;processPacket(qp);&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;align=left;" vertex="1" parent="1">
          <mxGeometry x="521" y="3610" width="274" height="78.13" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-380" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-377" target="S4009wVQ3V9HcJUpgxrX-379">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-386" value="把自己的状态改为 looking&lt;br&gt;进入下一轮 while 循环" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-380">
          <mxGeometry x="-0.2797" y="8" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-377" value="updateServerState();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="863.5" y="3110" width="171" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-379" value="setPeerState(ServerState.LOOKING);" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="889" y="3250" width="271" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-383" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-381" target="S4009wVQ3V9HcJUpgxrX-377">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="844" y="3340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-384" value="如果 leader 挂了，这里&lt;br&gt;从 leader 取数据会抱异常" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-383">
          <mxGeometry x="-0.4162" y="7" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-381" value="readPacket(qp);" style="whiteSpace=wrap;html=1;fontSize=14;align=center;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="857" y="3609.995" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-391" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-387" target="S4009wVQ3V9HcJUpgxrX-390">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-393" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-387" target="S4009wVQ3V9HcJUpgxrX-392">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-387" value="makeLeader(logFactory)" style="whiteSpace=wrap;html=1;fontSize=14;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-144.25" y="2800" width="185" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-398" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-390" target="S4009wVQ3V9HcJUpgxrX-397">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-399" value="初始化 LeaderZooKeeperServer 数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#FF0000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-398">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-390" value="leader.lead();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-111.75" y="2940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-395" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-392" target="S4009wVQ3V9HcJUpgxrX-394">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-396" value="监听 follower 节点的 socket 连接" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#FF0000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-395">
          <mxGeometry x="-0.1" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-392" value="new Leader(this, new &lt;font color=&quot;#ff0000&quot;&gt;LeaderZooKeeperServer&lt;/font&gt;(logFactory, this, this.zkDb));" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="95.75" y="2800" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-394" value="&lt;div&gt;ss = new ServerSocket();&lt;/div&gt;&lt;div&gt;ss.bind(self.getQuorumAddress());&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="85.75" y="2940" width="250" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-401" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-397" target="S4009wVQ3V9HcJUpgxrX-400">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-397" value="zk.loadData();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-111.75" y="3080" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-405" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-400" target="S4009wVQ3V9HcJUpgxrX-404">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-419" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-400" target="S4009wVQ3V9HcJUpgxrX-418">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-400" value="cnxAcceptor.start();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-125.5" y="3210" width="147.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-407" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-404" target="S4009wVQ3V9HcJUpgxrX-406">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-414" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-404" target="S4009wVQ3V9HcJUpgxrX-413">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-415" value="leader 与所有的 follower&lt;br&gt;定时发送 ping 请求，保持长连接" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-414">
          <mxGeometry x="-0.2137" y="6" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-404" value="startZkServer();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-111.75" y="3340" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-409" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-406" target="S4009wVQ3V9HcJUpgxrX-408">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-406" value="zk.startup();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-311.75" y="3340" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-411" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF0000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-408" target="S4009wVQ3V9HcJUpgxrX-410">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-412" value="构建 leader 请求处理链" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="S4009wVQ3V9HcJUpgxrX-411">
          <mxGeometry x="-0.1789" y="3" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-408" value="super.startup();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-311.75" y="3480" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-410" value="setupRequestProcessors();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-350.5" y="3619.06" width="197.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-417" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-413" target="S4009wVQ3V9HcJUpgxrX-416">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-413" value="&lt;div&gt;for (LearnerHandler f : getLearners()) {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;f.ping();&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;align=left;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="-99.25" y="3550" width="257.5" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-416" value="&lt;div&gt;QuorumPacket ping = new QuorumPacket(Leader.PING, id, null, null);&lt;/div&gt;&lt;div&gt;queuePacket(ping);&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;align=left;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;spacing=6;" vertex="1" parent="1">
          <mxGeometry x="-150.5" y="3730" width="456.25" height="70" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-421" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-418" target="S4009wVQ3V9HcJUpgxrX-420">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-418" value="LearnerCnxAcceptor#run" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="63.25" y="3080" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-420" value="s = ss.accept();" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="93.25" y="3190" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-427" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;startArrow=none;startFill=0;strokeColor=#000000;dashed=1;" edge="1" parent="1" source="S4009wVQ3V9HcJUpgxrX-425" target="S4009wVQ3V9HcJUpgxrX-420">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4009wVQ3V9HcJUpgxrX-425" value="sockConnect(sock, addr, Math.min(self.tickTime * self.syncLimit, remainingInitLimitTime));" style="whiteSpace=wrap;html=1;fontSize=14;fillColor=rgb(255, 255, 255);strokeColor=rgb(0, 0, 0);fontColor=rgb(0, 0, 0);rounded=0;" vertex="1" parent="1">
          <mxGeometry x="277.5" y="3161.25" width="200" height="92.5" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
